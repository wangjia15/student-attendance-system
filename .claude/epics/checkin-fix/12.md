# Task 12: Integrate WebSocket with Attendance APIs

## Metadata
```yaml
id: 12
epic: checkin-fix
title: Integrate WebSocket with Attendance APIs
description: Add WebSocket broadcast calls to attendance endpoints and enhance verification code validation for real-time updates
created: 2025-09-09T14:46:43Z
size: M
estimate: 6 hours
depends_on: [11]
parallel: false
status: todo
priority: high
tags: [websocket, api, attendance, real-time]
```

## Overview
Integrate WebSocket broadcasting with existing attendance API endpoints to provide real-time updates when attendance records are created or modified. Enhance the verification code validation system for class joining and implement comprehensive attendance state change notifications.

## Technical Details

### Files to Modify
- `backend/app/api/v1/attendance.py` - Add WebSocket broadcasts to POST endpoints
- `backend/app/api/v1/classes.py` - Enhance verification code validation in class joining
- `backend/app/core/websocket.py` - Ensure broadcast methods support attendance updates
- `backend/app/schemas/attendance.py` - Add WebSocket message schemas if needed

### Implementation Steps
1. Add WebSocket broadcast calls after successful attendance record creation
2. Add WebSocket broadcast calls after successful attendance record updates
3. Enhance verification code validation in class joining endpoint
4. Implement attendance state change notification messages
5. Add proper error handling for WebSocket broadcast failures
6. Ensure broadcasts include relevant attendance data for connected clients

### WebSocket Message Types to Implement
- `attendance_created` - New attendance record
- `attendance_updated` - Modified attendance record
- `student_joined_class` - Student successfully joined class
- `attendance_state_changed` - General attendance state updates

## Acceptance Criteria
- [ ] WebSocket broadcasts are sent after successful attendance POST operations
- [ ] Verification code validation is enhanced with real-time feedback
- [ ] Connected clients receive real-time notifications for attendance changes
- [ ] WebSocket broadcast failures don't affect REST API operation
- [ ] Appropriate error handling for WebSocket communication failures
- [ ] Message format includes necessary data for client-side updates
- [ ] Only authorized users receive attendance updates for their classes
- [ ] Performance impact of broadcasts is minimal on REST API response times

## Dependencies
- Task 11: Enable Production WebSocket Server

## Notes
This task builds on the WebSocket foundation from Task 11 to provide real-time functionality. The existing attendance endpoints should already have the core logic; this task adds the broadcasting layer.
